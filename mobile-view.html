<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Preview — Veleris</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow">

  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0f;
      --panel:#0f1115;
      --muted:#9aa0b2;
      --accent:#fff;
    }

    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:var(--bg);color:var(--accent);font-family:Inter,system-ui,-apple-system,sans-serif;display:flex;flex-direction:column}

    /* Topbar */
    .topbar{display:flex;align-items:center;gap:12px;padding:12px 14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);backdrop-filter:blur(6px)}
    .back-btn{width:40px;height:40px;border-radius:10px;border:0;background:transparent;color:var(--accent);display:inline-flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer}
    .title{font-size:0.95rem;color:var(--accent);font-weight:600}

    /* PREVIEW */
    .preview{flex:1;display:flex;align-items:center;justify-content:center;padding:18px}
    .preview-inner{width:100%;max-width:560px;border-radius:28px;overflow:hidden;background:linear-gradient(180deg,#0b0b0f, #0f1115);display:flex;align-items:center;justify-content:center;padding:20px}
    .preview img{width:100%;height:auto;max-height:82vh;object-fit:cover;border-radius:14px;box-shadow:0 20px 40px rgba(0,0,0,0.6)}

    /* Controls floating over bottom */
    .controls{position:fixed;left:0;right:0;bottom:18px;display:flex;justify-content:center;padding:0 18px}
    .download{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;background:#fff;color:#000;border-radius:999px;border:0;font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,0.45);cursor:pointer}
    .download svg{width:18px;height:18px}
    .meta{position:fixed;left:18px;bottom:86px;color:var(--muted);font-size:0.875rem}

    .fallback{text-align:center;color:var(--muted);padding:40px;font-size:0.95rem}
  </style>
</head>

<body>

  <div class="topbar">
    <button class="back-btn" aria-label="Go back" onclick="goBack()">←</button>
    <div class="title">Preview</div>
  </div>

  <div class="preview">
    <div class="preview-inner">
      <img id="wall" alt="Wallpaper preview">
    </div>
  </div>

  <div class="meta" id="meta"></div>

  <div class="controls">
    <button class="download" id="downloadBtn">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 3v10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 11l4 4 4-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21H3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Download
    </button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const img = params.get("img");
    const v = params.get("v") || Date.now();
    const imageEl = document.getElementById("wall");
    const metaEl = document.getElementById('meta');
    const downloadBtn = document.getElementById('downloadBtn');

    function goBack(){ if(window.history.length>1) window.history.back(); else window.location.href='collections.html'; }
    window.goBack = goBack;

    if (!img) {
      document.body.innerHTML = `<div class="fallback">Wallpaper not found.</div>`;
    } else {
      const src = `assets/wallpapers/mobile/${img}?v=${v}`;
      imageEl.src = src;
      metaEl.textContent = img.replace(/[-_]/g, ' ');

      async function downloadWallpaper(){
        try{
          const res = await fetch(src, {mode:'cors'});
          if(!res.ok) throw new Error('fetch failed');
          const blob = await res.blob();
          const blobUrl = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = blobUrl;
          a.download = img;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(blobUrl);
        }catch(e){
          // fallback to direct link
          const a = document.createElement('a');
          a.href = src;
          a.download = img;
          document.body.appendChild(a);
          a.click();
          a.remove();
        }
      }

      downloadBtn.addEventListener('click', downloadWallpaper);
    }
  </script>

</body>
</html>
